{% extends '::admin.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    
{% endblock %}

{% block body %}

{% set empresa_id = usuario_empresa ? usuario.empresa.id : 0 %}
{% set uri = app.request.getbasepath %}
<br><br>
<input type="hidden" id="root_site" name="root_site" value="{{ uri }}" />
<input type="hidden" id="usuario_empresa" name="usuario_empresa" value="{{ empresa_id }}">
<input type="hidden" id="deslen" name="deslen" value="0" />
<input type="hidden" id="url_list" name="url_list" value="{{ path('_notificacion', { 'app_id': app.session.get('app_id') }) }}">
{% if usuario_empresa %}
    <input type="hidden" id="empresa_id" name="empresa_id" value="{{ empresa_id }}">
{% endif %}

<div class="row align-items-center justify-content-start">
    <div class="col text-left">
        <a href="{{ path('_notificacion', { 'app_id': app.session.get('app_id') })}}" class="bttn__bck"><span class="fa fa-clipboard"></span><span class="text__bck">{{ 'Ir al listado'|trans }}</span></a>
    </div>
</div>
<br>
<div class="col-sm-16 col-md-16 col-lg-16 col-xl-16 alert alert-danger" role="alert" id="div-error" style="display:none;">
    <ul></ul>
</div>
<div class="row">
    <div class="col-sm-16 col-md-16 col-lg-16 col-xl-16">
        <div class="card">
            <div class="card-header"  style=" background: linear-gradient(to right, #d5ff00 0%, #A3C300 100%); ">
                <h5 class="card-title">{{'Datos Notificación'|trans}}</h5>
            </div>
            <div class="card-block">
                {{ form_start(form, { 'attr': { 'id': 'form', 'role': 'form' } }) }}
                <input type="hidden" id="notificacion_id" name="notificacion_id" value="">
                <div class="row">
                    <div class="form-group col-sm-16 col-md-16 col-lg-16 col-xl-16">
                        <label for="asunto" class="form-conttipo_notificacion-label">{{ form_label(form.asunto) }}:</label>
                        <div class="col-sm-16 col-md-16 col-lg-16 col-xl-16">
                            {{ form_widget(form.asunto, { 'attr': { 'class': 'form-control form_sty1' } }) }}
                            <span class="fa fa-font"></span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-sm-16 col-md-16 col-lg-16 col-xl-16">
                        <label for="tipo_notificacion_id" class="form-conttipo_notificacion-label">{{ form_label(form.tipoNotificacion) }}:</label>
                        <div class="col-sm-16 col-md-16 col-lg-16 col-xl-16">
                            {{ form_widget(form.tipoNotificacion, { 'attr': { 'class': 'form-control form_sty_select' } }) }}
                            <span class="fa fa-tags"></span>
                        </div>
                    </div>
                </div>   
                {% if not usuario_empresa %}
                    <div class="row">
                        <div class="form-group col-sm-16 col-md-16 col-lg-16 col-xl-16">
                            <label for="form_empresa_id" class="form-conttipo_notificacion-label">{{ form_label(form.empresa) }}:</label>
                            <div class="col-sm-16 col-md-16 col-lg-16 col-xl-16">
                                {{ form_widget(form.empresa, { 'attr': { 'class': 'form-control form_sty_select' } }) }}
                                <span class="fa fa-industry"></span>
                            </div>
                        </div>
                    </div>                           
                {% endif %}
                <div class="row">
                    <div class="form-group col-sm-16 col-md-16 col-lg-16 col-xl-16">
                        <label for="mensaje" class="form-conttipo_notificacion-label">{{ form_label(form.mensaje) }}:</label>
                        <div class="col-sm-16 col-md-16 col-lg-16 col-xl-16">
                            {{ form_widget(form.mensaje, { 'attr': { 'class': 'ckeditor' } }) }}
                        </div>
                    </div>
                </div>                     
                <div class="row">
                    <div class="form-group col-sm-16 col-md-16 col-lg-16 col-xl-16 text-right">
                        <div class="col-sm-16 col-md-16 col-lg-16 col-xl-16">
                            <button type="button" class="bttn__end" id="finish"><span class="text__end">{{ 'Guardar'|trans }}</span><span class="fa fa-save"></span></button>
                        </div>
                    </div>
                </div> 
                {{ form_end(form) }}
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="{{ asset('assets/vendor/ckeditor/ckeditor.js') }}"></script>
    <script type="text/javascript" src="{{ asset('assets/vendor/ckeditor/config.js') }}"></script>
    <script type="text/javascript" src="{{ asset('jq/jquery-validation-1.15.0/dist/jquery.validate.js') }}"></script>
    <script type="text/javascript" src="{{ asset('jq/jquery-validation-1.15.0/dist/additional-methods.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('js/admin/notificacionesFormulario.js') }}"></script>
    <script type="text/javascript">

    $('#finish').click(function(){
            var valid = $("#form").valid();
            if (!valid) 
            {
                notify($('#div-error').html());
            }
            else 
            {     
                var deslen = $('#deslen').val();
                error = 0;
                
                if (deslen < {{ minlenght_bienvenida }} )
                {
                    error = 1;
                    $('#div-error ul').html("<li>- {{ 'El mensaje es requerido.'|trans }}</li>");
                }
                if (error == 1)
                {
                    $('#div-error ul').show();
                    notify($('#div-error').html());
                }
                else {
                    $('#form').submit();
                }
            }
        });
        

        $("#form").validate({
            errorLabelContainer: "#div-error ul",
            wrapper: "li",
            ignore: "",
            rules: {
                'form[asunto]': {
                    required: true,
                    minlength: 3
                },
                'deslen': {
                    required: true,
                    min: 3
                },
                'form[tipoNotificacion]': {
                    required: true
                }
            },
            messages: {
                'form[asunto]': {
                    required: "- {{ 'El asunto de la notificación es requerido.'|trans }}",
                    minlength: "- {{ 'El asunto de la notificación debe ser mínimo de 3 caracteres.'|trans }}"
                },
                'deslen': {
                    required: "- {{ 'El mensaje es requerido.'|trans }}",
                    min: "- {{ 'El mensaje es requerido.'|trans }}"
                },
                'form[tipoNotificacion]': {
                    required: "- {{ 'El tipo de notificación es requerida.'|trans }}",
                }
            }
        });

        </script>
{% endblock %}