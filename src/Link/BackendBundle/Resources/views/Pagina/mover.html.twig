{% extends '::admin.html.twig'%}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('assets/vendor/jstree/dist/themes/default/style.min.css') }}" type="text/css">
{% endblock %}

{% block body %}

<br><br>
<div class="row align-items-center justify-content-between">
    <div class="col text-left">
        <a href="{{ path('_paginas', { 'app_id': app.session.get('app_id') })}}" class="bttn__bck"><span class="fa fa-clipboard"></span><span class="text__bck">{{ 'Ir al listado'|trans }}</span></a>
    </div>
    {% if pagina.pagina %}
        <div class="col text-right">
            <a href="{{ path('_pagina', { 'pagina_id': pagina.pagina.id })}}" class="bttn__bck"><span class="fa fa-level-up"></span><span class="text__bck">{{ 'Volver'|trans }}</span></a>
        </div>
    {% endif %}
</div>
<div class="row align-items-center justify-content-start">
    <div class="col-sm-4 col-md-4 col-lg-4">
        <a href="{{ path('_paginas', { 'app_id': app.session.get('app_id')  }) }}" class="bttn__bck2"><span class="fa fa-clipboard"></span><span class="text__bck2">{{ 'Ir al listado'|trans }}</span></a>
    </div>
    <div class="col-sm-8 col-md-8 col-lg-8 alert alert-danger" role="alert" id="div-error" style="display:none;">
        <ul></ul>
    </div>
</div>

<div class="row">
	<div class="col-sm-16">
        <div class="card">
            <div class="card-header gradiente">
                <div class="card-title">
                    <h6>{{ 'Mover Página'|trans }}</h6>
                </div>
            </div>
            {% if paginas.tiene > 1 %}
                <div class="card-block fnd__wzd">
                    <form id="form_mover" name="form_mover" action="{{ path('_moverPagina', { 'pagina_id': pagina.id }) }}" class="container-fluid p-0" method="POST">
                        <div class="row">
                            <div class="col-sm-6 col-md-6 col-lg-6 col-xl-6">
                                <div class="form-group">
                                    <h5>{{ 'Programa'|trans }}: {{ pagina.nombre }} </h5>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-10 col-md-10 col-lg-10 col-xl-10">
                               <h5>{{ 'Seleccione la Página a mover'|trans }}</h5>
                                <div class="row">
                                    <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 offset-sm-2 offset-md-2 offset-lg-2 offset-xl-2 pnl__tree">
                                        {% if paginas.tiene > 0 %}
                                            <div class="tree">
                                                <ul data-jstree='{ "opened" : true }'>
                                                    {{ paginas.str|raw }}
                                                </ul>
                                            </div>
                                        {% else %}
                                            {{ 'No existen páginas'|trans }}
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6 col-md-6 col-lg-6 col-xl-6">
                                <div class="form-group">
                                    <label for="pg_sel" class="col-16 col-form-label">{{ 'Página seleccionada'|trans }}</label>
                                    <div class="col-14">
                                        <input type="text" class="form-control" id="pagina_str" name="pagina_str" readonly="readonly" value="">
                                        <input type="hidden" id="pagina_mover_id" name="pagina_mover_id" value="">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                    <div class="wizard-footer">
                        <div class="col-sm-16 text-right">
                            <button type="button" class="bttn__end" id="finish"><span class="text__end">{{ 'Finalizar'|trans }}</span><span class="fa fa-check"></span></button>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="card-block fnd__wzd">
                    <div class="row">
                        <div class="col-sm-10 col-md-10 col-lg-10 col-xl-10">
                           <h5>{{ 'No puede mover la página seleccionada.'|trans }}</h5>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
	</div>
</div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="{{ asset('jq/jquery-validation-1.15.0/dist/jquery.validate.js') }}"></script>
    <script type="text/javascript" src="{{ asset('jq/jquery-validation-1.15.0/dist/additional-methods.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('assets/vendor/jstree/dist/jstree.min.js') }}"></script>

    <script type="text/javascript">

        $('#finish').click(function(){
            $('#form_mover').submit();
        });

        jQuery.validator.addMethod("greaterThan", function(value, element, param) { 
            var $otherElement = $(param);
            return parseInt(value, 10) >= parseInt($otherElement.val(), 10);
        });

        $('.tree').jstree();

        $('.tree').on("select_node.jstree", function (e, data) {
            var id = data.node.id;
            var pagina_mover_id = $('#'+id).attr('p_id');
            var pagina_str = $('#'+id).attr('p_str');
            $('#pagina_str').val(pagina_str);
            $('#pagina_mover_id').val(pagina_mover_id);
         
        });

    </script>
{% endblock %}
